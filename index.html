<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ghost Calli HSX</title>
</head>
<body>
<h1>üìÇ Drop your HSX files here</h1>

<!-- Visible drop zone -->
<div id="drop-zone" style="border:2px dashed #666; padding:20px; text-align:center;">
  Drop HSX files here
</div>

<script type="module">
  // Import the old runtime for full HSX features
  import { HSXRuntime } from "./hsx-runtime.js";
  const hsx = new HSXRuntime();

  // Import the new Engine for custom extensions
  import { HSXEngine } from "./Engine.js";
  const hsxEngine = new HSXEngine();

  // -----------------------------
  // Drag-and-drop support
  // -----------------------------
  const dropZone = document.getElementById("drop-zone");

  dropZone.addEventListener("dragover", e => e.preventDefault());
  dropZone.addEventListener("drop", async e => {
    e.preventDefault();
    for (const file of e.dataTransfer.files) {
      if (file.name.endsWith(".hsx")) {
        console.log("üìÇ Dropped:", file.name);

        // 1Ô∏è‚É£ Load via runtime first (renders UI)
        await hsx.loadFromFile(file);

        // 2Ô∏è‚É£ Feed same file to engine for CCCL/custom features
        const text = await file.text();
        hsxEngine.run(text);
      }
    }
  });

  // -----------------------------
  // Load the main HSX file via runtime first
  // -----------------------------
  async function loadMainHSX() {
    try {
      const response = await fetch("source.hsx");
      if (response.ok) {
        const code = await response.text();

        // 1Ô∏è‚É£ First, render the UI via runtime
        await hsx.loadFromText(code);

        // 2Ô∏è‚É£ Then, run engine for CCCL logic
        hsxEngine.run(code);
      } else {
        console.log("‚ö†Ô∏è source.hsx not found");
      }
    } catch (err) {
      console.error("Error loading main HSX for Engine:", err);
    }
  }

  loadMainHSX();
</script>
</body>
</html>
