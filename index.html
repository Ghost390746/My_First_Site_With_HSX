<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ghost Calli HSX</title>
</head>
<body>
<h1>ðŸ“‚ Drop your HSX files here</h1>

<!-- Visible drop zone -->
<div id="drop-zone" style="border:2px dashed #666; padding:20px; text-align:center;">
  Drop HSX files here
</div>

<script type="module">
import { HSXRuntime } from "./hsx-runtime.js";
import { HSXEngine } from "./Engine.js";

const hsx = new HSXRuntime();
const hsxEngine = new HSXEngine();

// ----------- Initialization function -----------
async function initHSX() {
  try {
    // --- Load the main HSX file via runtime (await ensures DOM renders) ---
    await hsx.load("source.hsx");
    console.log("âœ… HSXRuntime loaded main file.");

    // --- Fetch the same HSX file for engine logic ---
    const response = await fetch("source.hsx");
    if (response.ok) {
      const code = await response.text();
      hsxEngine.run(code);
      console.log("âœ… HSXEngine ran main file logic.");
    }

  } catch (err) {
    console.error("âš ï¸ Failed to load main HSX:", err);
  }
}

// --- Drag-and-drop support ---
const dropZone = document.getElementById("drop-zone");
dropZone.addEventListener("dragover", e => e.preventDefault());
dropZone.addEventListener("drop", async e => {
  e.preventDefault();

  for (const file of e.dataTransfer.files) {
    if (!file.name.endsWith(".hsx")) continue;

    console.log("ðŸ“‚ Dropped:", file.name);

    // --- Runtime handles rendering ---
    await hsx.loadFromFile(file);

    // --- Engine handles custom logic ---
    const text = await file.text();
    hsxEngine.run(text);
  }
});

// --- Start everything ---
initHSX();
</script>
</body>
</html>
